<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Consignes TP5 - Tests end-to-end</title>
        <link
            rel="stylesheet"
            href="https://danyellow.net/cours-mmi/consignes.css"
        />

        <script src="https://danyellow.net/cours-mmi/scripts.js" defer></script>
    </head>

    <body>
        <header>
            <h1 class="h1">
                Consignes de la pratique - TP5 - Tests end-to-end
            </h1>
            <details class="consignes-conteneur" open>
                <summary>
                    <h1 class="h1">
                        Partie 1 (cliquer pour afficher / cacher)
                    </h1>
                </summary>
                <ol class="liste-consignes">
                    <li>
                        Ouvrez dans la console (Terminal / iTerm2 sur MacOS ou
                        git bash sur Windows) le dossier ressources/playwright et
                        installez les dépendances avec la commande
                        <code>npm run install</code>
                        <p class="note-information">S'il vous manque certains navigateurs, vous devrez installer leur version exécutable. Par exemple pour Chromium, il faut utiliser la commande <code>npx playwright install chromium</code>. Playwright vous l'indiquera dans le terminal en tous les cas.</p>
                    </li>
                    <li>
                        Ouvrez playwright en exécutant la commande
                        <code>npm run e2e</code> ou
                        <code>npm run playwright</code> dans la console
                    </li>
                    <li>
                        Cliquez sur un des icônes "play" de la fenêtre de
                        Playwright pour exécuter votre premier test e2e
                    </li>
                </ol>
                <p class="note-information">
                    Le projet que vous avez récupéré possède Playwright ôté de certains fichiers et déjà configuré, notamment pour l'utilisation de modules javascript. Dans une configuration standard, Playwright crée plus de fichiers et dossiers.
                </p>
            </details>
            <details class="consignes-conteneur">
                <summary>
                    <h1 class="h1">
                        Partie 2 (cliquer pour afficher / cacher)
                    </h1>
                </summary>
                <ol class="liste-consignes">
                    <li>
                        Améliorez le test contenu dans "tests/example.spec.js"
                        pour cliquer sur la première actualité (zone
                        "actualités") de la page d'accueil
                        <ul>
                            <li>
                                <a
                                    href="https://playwright.dev/docs/api/class-locator#locator-click"
                                    target="_blank"
                                    >Accéder à la documentation de .click()</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li>
                        Vérifiez que vous êtes bien arrivé sur la page d'une
                        actualité en utilisation une assertion
                        <ul>
                            <li>
                                Pour éviter un test trop rigide, n'allez pas
                                tester l'égalité parfaite, cela n'a pas trop de
                                sens. Les liens d'actualité contiennent
                                "universite/media-et-communication/actualites"
                                testez si l'url courante contient bien cette
                                partie grâce à la méthode
                                <code>.toHaveURL()</code>. Elle accepte des RegEx.
                                <a
                                    href="https://playwright.dev/docs/next/api/class-pageassertions#page-assertions-to-have-url"
                                    target="_blank"
                                    >Accéder à la documentation de
                                    .toHaveURL()</a
                                >
                            </li>
                        </ul>
                    </li>
                </ol>
            </details>
            <details class="consignes-conteneur">
                <summary>
                    <h1 class="h1">
                        Partie 3 (cliquer pour afficher / cacher)
                    </h1>
                </summary>
                <ul class="liste-consignes">
                    <li>
                        Ajoutez un nouveau test (fichier de test ou bloc de
                        test) qui respecte le plan suivant :
                        <ol>
                            <li>
                                Accède au site wikipédia (<a
                                    href="https://fr.wikipedia.org/wiki/Wikip%C3%A9dia:Accueil_principal"
                                    target="_blank"
                                    >https://fr.wikipedia.org/wiki/Wikip%C3%A9dia:Accueil_principal</a
                                >)
                            </li>
                            <li>
                                Effectue une recherche de votre choix en
                                écrivant dans le champ de recherche, il faut
                                utiliser la méthode <code>fill()</code>
                            </li>
                            <li>
                                S'assure que vous êtes sur la page de votre
                                recherche
                            </li>
                        </ol>
                    </li>
                </ul>
                <section class="note-information">
                    <ul>
                        <li>
                            <a
                                href="https://playwright.dev/docs/api/class-locator#locator-fill"
                                target="_blank"
                                >Accéder à la documentation de locator.fill()
                                (ouverture dans un nouvel onglet)</a
                            >
                        </li>
                    </ul>
                </section>
            </details>
            <details class="consignes-conteneur">
                <summary>
                    <h1 class="h1">
                        Partie 4 (cliquer pour afficher / cacher)
                    </h1>
                </summary>
                <ol class="liste-consignes">
                    <li>
                        Ouvrez dans la console (Terminal / iTerm2 sur MacOS ou
                        git bash sur Windows) le dossier ressources/playwright
                        (nouvelle fenêtre ou onglet de votre terminal)
                    </li>
                    <li>Exécutez la commande <code>npm run server</code></li>
                    <li>
                        Ajoutez un nouveau fichier de test, dans le dossier dédié, avec le test qui
                        respecte le plan suivant :
                        <ol>
                            <li>Accède à "http://localhost:3000"
                                <p class="note-information">Cette url est déjà définie dans la configuration de Playwright. Libre à vous d'utiliser "/" ou "http://localhost:3000" dans vos tests.</p>
                            </li>
                            <li>Remplit le formulaire</li>
                            <li>
                                Vérifie que le formulaire a été soumis
                                <ul>
                                    <li>
                                        Pensez à tester / découvrir le
                                        formulaire manuellement avant d'écrire
                                        vos tests
                                    </li>
                                    <li>
                                        Note : Il existe plusieurs moyens de
                                        savoir que le formulaire a été soumis
                                    </li>
                                </ul>
                            </li>
                        </ol>
                    </li>
                </ol>
                <section class="note-information">
                    <p>
                        Pour manipuler un &lt;select>, il faudra utiliser la
                        méthode ".selectOption()"
                    </p>
                    <ul>
                        <li>
                            <a
                                href="https://playwright.dev/docs/input#select-options"
                                target="_blank"
                                >Accéder à la documentation de .selectOption()
                                (ouverture dans un nouvel onglet)</a
                            >
                        </li>
                    </ul>
                </section>
            </details>
            <details class="consignes-conteneur">
                <summary>
                    <h1 class="h1">
                        Partie 5 (cliquer pour afficher / cacher)
                    </h1>
                </summary>
                <ol class="liste-consignes">
                    <li>
                        Réécrivez le test de la partie 4 en utilisant des
                        sélecteurs relatifs au data-attribute "data-testid"
                    </li>
                    <li>
                        Dans le fichier src/script.js remplacez les sélecteurs
                        de balises par des data-attributes personnalisés. Pas forcément des "data-testid"
                    </li>
                </ol>
                <section class="note-information">
                    <p>
                        Pour soumettre un formulaire, vous pouvez cliquer sur le
                        bouton dédié ou appuyer sur la touche "Enter" d'un champ de texte grâce à la méthode press().
                    </p>
                    <ul>
                        <li>
                            <a
                                href="https://playwright.dev/docs/api/class-locator#locator-press"
                                target="_blank"
                                >Accéder à la documentation de press()
                                (ouverture dans un nouvel onglet)</a
                            >
                        </li>
                    </ul>
                </section>
            </details>

            <details class="consignes-conteneur">
                <summary>
                    <h1 class="h1">
                        Partie 6 (cliquer pour afficher / cacher)
                    </h1>
                </summary>
                <ol class="liste-consignes">
                    <li>
                        Ajoutez un nouveau champ de type "file" dans le
                        formulaire contenu dans le fichier src/form.html avec le
                        libellé de votre choix tout comme son emplacement. Ce
                        champ est facultatif et doit permettre d'uploader une
                        image uniquement.
                    </li>
                    <li>
                        Mettez à jour vos tests (des parties 4 et 5) pour
                        prendre en compte ces modifications
                    </li>
                    <li>
                        Ajoutez un autre test pour vous assurer que le
                        formulaire est bien réintialisé avec le bouton
                        "rechoisir"
                    </li>
                </ol>
                <section class="note-information">
                    <p>
                        N'oubliez pas que le chemin de l'image est relatif à la racine du projet pour la méthode <a href="https://playwright.dev/docs/api/class-locator#locator-set-input-files" target="_blank">.setInputFiles()</a>
                    </p>
                </section>
            </details>
            <details class="consignes-conteneur">
                <summary>
                    <h1 class="h1">
                        Partie 7 (cliquer pour afficher / cacher)
                    </h1>
                </summary>
                <ol class="liste-consignes">
                    <li>
                        L'API retourne une liste d'éléments. Elle est accessible à "http://localhost:3000/api". Affichez-en le contenu sur le site. Préférez l'utilisation de la balise &lt;template>.
                    </li>
                    <li>
                        Mockez la réponse d'API
                        <p class="note-information">L'API est lente. Il faudra penser à utiliser la méthode waitForResponse</p>

                        <ul>
                            <li>Accéder à la documentation de <a href="https://playwright.dev/docs/api/class-page#page-wait-for-response" target="_blank">waitForResponse (ouverture dans un nouvel onglet)</a></li>
                        </ul>
                    </li>
                </ol>
            </details>
            <details class="consignes-conteneur">
                <summary>
                    <h1 class="h1">
                        Partie 8 (cliquer pour afficher / cacher)
                    </h1>
                </summary>
                <ol class="liste-consignes">
                    <li>
                        Faites une capture d'écran de n'importe quel site durant
                        un test
                        <ul>
                            <li>
                                <a
                                    href="https://playwright.dev/docs/api/class-page#page-screenshot"
                                    target="_blank"
                                    >Accéder à la documentation de
                                    screenshot() (ouverture dans un nouvel
                                    onglet)</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li>
                        Prennez une capture d'écran mobile, tablette et PC du
                        site de l'université (https://www.cyu.fr/). Si vous le
                        souhaitez, vous pouvez également gérer l'orientation de
                        l'écran
                        <ul>
                            <li>
                                <a
                                    href="https://playwright.dev/docs/api/class-page#page-set-viewport-size"
                                    target="_blank"
                                    >Accéder à la documentation de setViewportSize()
                                    (ouverture dans un nouvel onglet)</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li>
                        Faites une capture d'écran durant un test sur le site de
                        l'université (https://www.cyu.fr/)
                        <span class="texte-gras"
                            >sans que la navigation haute n'apparaisse à
                            plusieurs reprises de même pour l'encart des
                            cookies</span
                        >
                        <ul>
                            <li>
                                <a
                                    href="https://playwright.dev/docs/api/class-page#page-evaluate"
                                    target="_blank"
                                    >Accéder à la documentation de evaluate()
                                    (ouverture dans un nouvel onglet)</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li>
                        Créez un cookie en javascript lorsque le formulaire est validé et
                        vérifiez sa présence grâce à playwright
                        <ul>
                            <li>
                                <a
                                    href="https://playwright.dev/docs/api/class-browsercontext#browser-context-cookies"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    >Voir documentation de cookies dans
                                    playwright (ouveture dans un nouvel onglet)</a
                                >
                                <p class="note-information">
                                    Notez bien que la méthode cookies() retourne un tableau d'objets, pour évaluer un cookie, il faudra filtrer ce tableau. Exemple : <code>expect(listCookies.find(item => item.name === "my_cookie").value).toBe("my_value")</code>. Par ailleurs les cookies sont contenus dans l'objet "context".
                                </p>
                            </li>
                            <li>
                                <a
                                    href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie#write_a_new_cookie"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    >Voir documentation de document.cookie en
                                    javascript (ouveture dans un nouvel
                                    onglet)</a
                                >
                            </li>
                        </ul>
                    </li>
                </ol>
                <section class="note-information">
                    <p>
                        Pour modifier le CSS, il faudra passer par la méthode
                        <code>evaluate()</code>. Par exemple :
                    </p>
                    <pre>
<code id="htmlViewer" style="color:rgb(248, 248, 248); font-weight:400;background-color:rgb(0, 0, 0);background:rgb(0, 0, 0);display:block;padding: .5em;"><span style="color:rgb(226, 137, 100); font-weight:400;">await</span> page
    .<span class="hljs-title function_">locator</span>(<span style="color:rgb(101, 176, 66); font-weight:400;">&quot;input&quot;</span>)
    .<span class="hljs-title function_">nth</span>(<span style="color:rgb(51, 135, 204); font-weight:400;">0</span>)
    .evaluate(<span style="color:rgb(248, 248, 248); font-weight:400;">(<span style="color:rgb(62, 135, 227); font-weight:400;">item</span>) =&gt;</span> {
        item.<span style="color:rgb(248, 248, 248); font-weight:400;">style</span>.<span style="color:rgb(248, 248, 248); font-weight:400;">display</span> = <span style="color:rgb(101, 176, 66); font-weight:400;">&quot;none&quot;</span>;
    });</code></pre>
                </section>
            </details>
        </header>
    </body>
</html>
